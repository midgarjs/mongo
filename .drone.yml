kind: pipeline
type: docker
name: nodejs
steps:
- name: build
  image: node:latest
  environment:
    MONGO_CONNEXION_URI: mongodb://mongo:27017/midgar-test?connectTimeoutMS=1000"
  commands:
    - yarn
    - yarn run coverage:ci
    - yarn run eslint:ci
- name: sonar
  image: aosapps/drone-sonar-plugin:latest
  settings:
    sonar_host:
      from_secret: sonar_host
    sonar_token:
      from_secret: sonar_token
    ver: 1.0
    sources: src/
    exclusions: docs/**/*
services:
- name: mongo
  image: mongo:4
  ports:
  - 27017
